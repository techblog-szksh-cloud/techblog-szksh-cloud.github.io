"use strict";(self.webpackChunktechblog_szksh_cloud_github_io=self.webpackChunktechblog_szksh_cloud_github_io||[]).push([[3565],{3905:function(e,a,t){t.d(a,{Zo:function(){return i},kt:function(){return c}});var r=t(7294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var m=r.createContext({}),p=function(e){var a=r.useContext(m),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},i=function(e){var a=p(e.components);return r.createElement(m.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},u=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,o=e.originalType,m=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),u=p(t),c=n,f=u["".concat(m,".").concat(c)]||u[c]||d[c]||o;return t?r.createElement(f,l(l({ref:a},i),{},{components:t})):r.createElement(f,l({ref:a},i))}));function c(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=t.length,l=new Array(o);l[0]=u;var s={};for(var m in a)hasOwnProperty.call(a,m)&&(s[m]=a[m]);s.originalType=e,s.mdxType="string"==typeof e?e:n,l[1]=s;for(var p=2;p<o;p++)l[p]=t[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8456:function(e,a,t){t.r(a),t.d(a,{assets:function(){return i},contentTitle:function(){return m},default:function(){return c},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return d}});var r=t(7462),n=t(3366),o=(t(7294),t(3905)),l=["components"],s={title:"Terraform \u30cf\u30f3\u30ba\u30aa\u30f3 with MySQL Provider",date:new Date("2020-01-17T00:14:08.000Z"),tags:["terraform"],authors:["suzuki-shunsuke"]},m=void 0,p={permalink:"/terraform-hands-on-with-mysql-provider",source:"@site/blog/terraform-hands-on-with-mysql-provider.md",title:"Terraform \u30cf\u30f3\u30ba\u30aa\u30f3 with MySQL Provider",description:"Terraform \u3092\u52c9\u5f37\u3059\u308b\u306b\u306f\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u307f\u308b\u306e\u304c\u4e00\u756a\u624b\u3063\u53d6\u308a\u65e9\u3044\u3067\u3059\u304c\u3001",date:"2020-01-17T00:14:08.000Z",formattedDate:"January 17, 2020",tags:[{label:"terraform",permalink:"/tags/terraform"}],readingTime:39.02,truncated:!1,authors:[{name:"Shunsuke Suzuki",title:"SRE / OSS Contributor / Tool Maker / Go / Terraform",url:"https://github.com/suzuki-shunsuke",imageURL:"https://github.com/suzuki-shunsuke.png",key:"suzuki-shunsuke"}],frontMatter:{title:"Terraform \u30cf\u30f3\u30ba\u30aa\u30f3 with MySQL Provider",date:"2020-01-17T00:14:08.000Z",tags:["terraform"],authors:["suzuki-shunsuke"]},prevItem:{title:"Skaffold \u3067\u7279\u5b9a\u306e\u30b5\u30fc\u30d3\u30b9\u3060\u3051\u52d5\u304b\u3059\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3092\u4f5c\u3063\u305f",permalink:"/skaffold-generator"},nextItem:{title:"Terraform \u5165\u9580",permalink:"/terraform-getting-started"}},i={authorsImageUrls:[void 0]},d=[{value:"Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3068 tfenv",id:"terraform-\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3068-tfenv",level:2},{value:"MySQL \u3092 Docker \u3067\u52d5\u304b\u3059",id:"mysql-\u3092-docker-\u3067\u52d5\u304b\u3059",level:2},{value:"Docker Compose \u4f7f\u3046\u5834\u5408",id:"docker-compose-\u4f7f\u3046\u5834\u5408",level:3},{value:"Docker Compose \u3092\u4f7f\u308f\u306a\u3044\u5834\u5408",id:"docker-compose-\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408",level:3},{value:"\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210",id:"\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210",level:2},{value:"\u53e4\u3044 Terraform \u3092\u4f7f\u3063\u3066\u307f\u308b",id:"\u53e4\u3044-terraform-\u3092\u4f7f\u3063\u3066\u307f\u308b",level:2},{value:"\u30ea\u30bd\u30fc\u30b9\u306e\u66f4\u65b0",id:"\u30ea\u30bd\u30fc\u30b9\u306e\u66f4\u65b0",level:2},{value:"terraform.tfstate.backup",id:"terraformtfstatebackup",level:2},{value:"\u30ea\u30bd\u30fc\u30b9\u306e recreate",id:"\u30ea\u30bd\u30fc\u30b9\u306e-recreate",level:2},{value:"\u5909\u6570\u306e\u5229\u7528",id:"\u5909\u6570\u306e\u5229\u7528",level:2},{value:"\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5c5e\u6027\u306e\u53c2\u7167",id:"\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5c5e\u6027\u306e\u53c2\u7167",level:2},{value:"terraform state rm",id:"terraform-state-rm",level:2},{value:"terraform import",id:"terraform-import",level:2},{value:"\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664",id:"\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664",level:2},{value:"terraform state mv",id:"terraform-state-mv",level:2},{value:"terraform refresh",id:"terraform-refresh",level:2},{value:"Module",id:"module",level:2},{value:"Module \u30d1\u30e9\u30e1\u30fc\u30bf",id:"module-\u30d1\u30e9\u30e1\u30fc\u30bf",level:3},{value:"Module Output",id:"module-output",level:3},{value:"terraform destroy",id:"terraform-destroy",level:2}],u={toc:d};function c(e){var a=e.components,t=(0,n.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Terraform \u3092\u52c9\u5f37\u3059\u308b\u306b\u306f\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u307f\u308b\u306e\u304c\u4e00\u756a\u624b\u3063\u53d6\u308a\u65e9\u3044\u3067\u3059\u304c\u3001\n\u3067\u306f\u624b\u9803\u306a\u984c\u6750\u306f\u3042\u308b\u304b\u3068\u8a00\u308f\u308c\u308b\u3068\u5c11\u3057\u96e3\u3057\u3044\u3067\u3059\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://learn.hashicorp.com/terraform/getting-started/build"},"\u516c\u5f0f\u306e Getting Started \u3067\u306f AWS \u304c\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059"),"\u304c\u3001\nAWS \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3084\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3057\u304a\u91d1\u3082\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u307e\u3059(\u7121\u6599\u67a0\u306f\u3042\u308a\u307e\u3059\u304c)\u3002\n\u3082\u3046\u5c11\u3057\u624b\u8efd\u306a\u3082\u306e\u304c\u6b32\u3057\u3044\u3068\u3053\u308d\u3067\u3059\u3002"),(0,o.kt)("p",null,"\u305d\u3053\u3067\u516c\u5f0f\u306e Provider \u3067\u4e01\u5ea6\u3044\u3044\u3082\u306e\u306f\u306a\u3044\u304b\u63a2\u3057\u305f\u3068\u3053\u308d\u3001 ",(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/providers/mysql/"},"MySQL Provider")," \u304c\u826f\u3055\u305d\u3046\u3067\u3057\u305f\u3002\nMySQL \u306e\u30e6\u30fc\u30b6\u30fc\u3084 Database \u3092 Terraform \u3067\u7ba1\u7406\u3057\u305f\u3044\u3068\u306f\u81ea\u5206\u306f\u601d\u3044\u307e\u305b\u3093\u304c\u3001 Terraform \u306e\u5165\u9580\u3067\u904a\u3076\u306b\u306f\u3061\u3087\u3046\u3069\u3088\u3044\u3067\u3057\u3087\u3046\u3002"),(0,o.kt)("p",null,"\u3061\u306a\u307f\u306b\u516c\u5f0f\u306e Provider \u306e\u30ea\u30b9\u30c8\u306f\u3053\u3061\u3089\u3067\u3059\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/terraform-providers"},"https://github.com/terraform-providers")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.terraform.io/docs/providers/index.html"},"https://www.terraform.io/docs/providers/index.html"))),(0,o.kt)("p",null,"\u307e\u305f\u3001 Terraform \u306b\u95a2\u3057\u3066\u306f ",(0,o.kt)("a",{parentName:"p",href:"https://techblog.szksh.cloud/terraform-getting-started/"},"Terraform \u5165\u9580")," \u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),(0,o.kt)("p",null,"\u4eca\u56de\u306e\u4f5c\u696d\u7528\u306b\u9069\u5f53\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u305d\u3053\u3067\u4f5c\u696d\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("p",null,"\u4ee5\u964d\u3001\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u7d50\u679c\u306f\u4e00\u90e8\u7701\u7565\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ mkdir workspace\n$ cd workspace\n")),(0,o.kt)("h2",{id:"terraform-\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3068-tfenv"},"Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3068 tfenv"),(0,o.kt)("p",null,"Terraform \u3092\u8907\u6570\u4eba\u3067\u4f7f\u3046\u5834\u5408\u3001 Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u63c3\u3048\u308b\u306e\u304c\u91cd\u8981\u3067\u3059\u3002 \u7406\u7531\u306e\u4e00\u3064\u3068\u3057\u3066\u3001 Terraform \u306e State \u306f State \u3092\u4f5c\u6210\u3057\u305f Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8a18\u9332\u3057\u3066\u304a\u308a\u3001\u305d\u308c\u3088\u308a\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e Terraform \u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u306a\u3069\u3092\u5b9f\u884c\u3059\u308b\u3068\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059(\u3053\u306e\u70b9\u306b\u3064\u3044\u3066\u306f\u5f8c\u3067\u3082\u89e6\u308c\u307e\u3059)\u3002\n\u305d\u3046\u3044\u3046\u610f\u5473\u3067\u306f\u3001 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tfutils/tfenv"},"tfenv")," \u306b\u3088\u3063\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3059\u308b\u306e\u304c\u826f\u3044\u3067\u3059\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},".terraform-version")," \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ echo 0.12.19 > .terraform-version\n$ tfenv install\n$ terraform version\nTerraform v0.12.19\n")),(0,o.kt)("h2",{id:"mysql-\u3092-docker-\u3067\u52d5\u304b\u3059"},"MySQL \u3092 Docker \u3067\u52d5\u304b\u3059"),(0,o.kt)("p",null,"\u3067\u306f MySQL \u3092 Docker \u3067\u52d5\u304b\u3057\u307e\u3059\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/_/mysql?tab=description"},"https://hub.docker.com/_/mysql?tab=description")),(0,o.kt)("h3",{id:"docker-compose-\u4f7f\u3046\u5834\u5408"},"Docker Compose \u4f7f\u3046\u5834\u5408"),(0,o.kt)("p",null,"docker-compose.yml"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'---\nversion: "3"\nservices:\n  mysql:\n    image: mysql:5.7.28\n    ports:\n    - "23306:3306"\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ docker-compose up -d\n$ docker-compose ps  # \u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n")),(0,o.kt)("p",null,"\u4e0d\u8981\u306b\u306a\u3063\u305f\u3089\u524a\u9664\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ docker-compose rm -sf mysql\n")),(0,o.kt)("p",null,"\u3053\u308c\u304b\u3089 Terraform \u3067 MySQL \u306e Database \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b MySQL \u306b\u63a5\u7d9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ docker-compose exec mysql mysql -u root -p -P 23306\nmysql> show databases;  # database \u306e\u4e00\u89a7\u3092\u78ba\u8a8d\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n")),(0,o.kt)("h3",{id:"docker-compose-\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408"},"Docker Compose \u3092\u4f7f\u308f\u306a\u3044\u5834\u5408"),(0,o.kt)("p",null,"\u57fa\u672c\u7684\u306b Docker Compose \u4f7f\u3046\u5834\u5408\u3068\u5909\u308f\u308a\u307e\u305b\u3093\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ docker run --name terraform-mysql -p "23306:3306" -e MYSQL_ROOT_PASSWORD=password -d mysql:5.7.28\n$ docker exec -ti terraform-mysql mysql -u root -p -P 23306\n$ docker rm -vf terraform-mysql\n')),(0,o.kt)("h2",{id:"\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210"},"\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210"),(0,o.kt)("p",null,"\u6b21\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u307e\u3059\u3002"),(0,o.kt)("p",null,"main.tf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'provider "mysql" {\n  endpoint = "localhost:23306"\n  username = "root"\n  password = "password"\n}\n\nresource "mysql_database" "foo" {\n  name = "foo"\n}\n')),(0,o.kt)("p",null,"\u8a2d\u5b9a\u3067\u304d\u308b\u5c5e\u6027\u3084\u305d\u306e\u610f\u5473\u306a\u3069\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/providers/mysql/r/database.html"},"https://www.terraform.io/docs/providers/mysql/r/database.html")),(0,o.kt)("p",null,"MySQL Provider \u306e\u8a2d\u5b9a\u3068\u3057\u3066 MySQL \u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u3068\u3001Terraform \u306b\u3088\u3063\u3066\u4f5c\u6210\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 ",(0,o.kt)("inlineCode",{parentName:"p"},"foo")," \u306e\u8a2d\u5b9a\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\npassword \u304c\u5e73\u6587\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u304c\u6c17\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4e00\u65e6\u30b9\u30eb\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),(0,o.kt)("p",null,"\u3053\u306e\u72b6\u614b\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u306f ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform apply")," \u306b\u3088\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u3092 DRY RUN \u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\n\nError: Could not satisfy plugin requirements\n\n\nPlugin reinitialization required. Please run "terraform init".\n\nPlugins are external binaries that Terraform uses to access and manipulate\nresources. The configuration provided requires plugins which can\'t be located,\ndon\'t satisfy the version constraints, or are otherwise incompatible.\n\nTerraform automatically discovers provider requirements from your\nconfiguration, including providers used in child modules. To see the\nrequirements and constraints from each module, run "terraform providers".\n\n\n\nError: provider.mysql: no suitable version installed\n  version requirements: "(any version)"\n  versions installed: none\n')),(0,o.kt)("p",null,"\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},'Plugin reinitialization required. Please run "terraform init".')),(0,o.kt)("p",null,"\u3068\u3042\u308b\u901a\u308a\u3001 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3084 ",(0,o.kt)("inlineCode",{parentName:"p"},"apply")," \u306a\u3069\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u524d\u306b ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform init")," \u3092\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform init\n\nInitializing the backend...\n\nInitializing provider plugins...\n- Checking for available provider plugins...\n- Downloading plugin for provider "mysql" (terraform-providers/mysql) 1.9.0...\n^C\nThe following providers do not have any version constraints in configuration,\nso the latest version was installed.\n\nTo prevent automatic upgrades to new major versions that may contain breaking\nchanges, it is recommended to add version = "..." constraints to the\ncorresponding provider blocks in configuration, with the constraint strings\nsuggested below.\n\n* provider.mysql: version = "~> 1.9"\n\nTerraform has been successfully initialized!\n\nYou may now begin working with Terraform. Try running "terraform plan" to see\nany changes that are required for your infrastructure. All Terraform commands\nshould now work.\n\nIf you ever set or change modules or backend configuration for Terraform,\nrerun this command to reinitialize your working directory. If you forget, other\ncommands will detect it and remind you to do so if necessary.\n')),(0,o.kt)("p",null,"Provider \u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"terraform init")," \u3092\u5b9f\u884c\u3059\u308b\u3068 ",(0,o.kt)("inlineCode",{parentName:"p"},".terraform")," \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ls -A\n.terraform  .terraform-version  main.tf\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"terraform init")," \u306f\u4f55\u5ea6\u3067\u3082\u5b89\u5168\u306b\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},".terraform")," \u3092\u524a\u9664\u3057\u305f\u5834\u5408\u3067\u3082\u3082\u3046\u4e00\u5ea6 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform init")," \u3092\u5b9f\u884c\u3059\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002"),(0,o.kt)("p",null,"\u6b21\u306b ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but will not be\npersisted to local or remote state storage.\n\n\n------------------------------------------------------------------------\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # mysql_database.foo will be created\n  + resource "mysql_database" "foo" {\n      + default_character_set = "utf8"\n      + default_collation     = "utf8_general_ci"\n      + id                    = (known after apply)\n      + name                  = "foo"\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\n------------------------------------------------------------------------\n\nNote: You didn\'t specify an "-out" parameter to save this plan, so Terraform\ncan\'t guarantee that exactly these actions will be performed if\n"terraform apply" is subsequently run.\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Plan: 1 to add, 0 to change, 0 to destroy.")),(0,o.kt)("p",null,"\u3068\u3042\u308b\u901a\u308a\u3001\u30ea\u30bd\u30fc\u30b9\u304c 1 \u3064\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002 DRY RUN \u306a\u306e\u3067\u307e\u3060\u4f5c\u6210\u3055\u308c\u3066\u307e\u305b\u3093\u3002"),(0,o.kt)("p",null,"\u3067\u306f\u5b9f\u969b\u306b\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform apply\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  + create\n\nTerraform will perform the following actions:\n\n  # mysql_database.foo will be created\n  + resource "mysql_database" "foo" {\n      + default_character_set = "utf8"\n      + default_collation     = "utf8_general_ci"\n      + id                    = (known after apply)\n      + name                  = "foo"\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only \'yes\' will be accepted to approve.\n\n  Enter a value: yes\n\nmysql_database.foo: Creating...\nmysql_database.foo: Creation complete after 0s [id=foo]\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n')),(0,o.kt)("p",null,"\u9014\u4e2d\u78ba\u8a8d\u304c\u3042\u308b\u306e\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"yes")," \u3068\u5165\u529b\u3059\u308b\u3068\u5b9f\u969b\u306b\u5909\u66f4\u304c\u9069\u7528\u3055\u308c\u307e\u3059\u3002"),(0,o.kt)("p",null,"\u672c\u5f53\u306b Database \u304c\u4f5c\u3089\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\nMySQL \u30af\u30a8\u30ea\u3092\u53e9\u304d\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| foo                |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.01 sec)\n\nmysql> select * from INFORMATION_SCHEMA.SCHEMATA where SCHEMA_NAME='foo';\n+--------------+-------------+----------------------------+------------------------+----------+\n| CATALOG_NAME | SCHEMA_NAME | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |\n+--------------+-------------+----------------------------+------------------------+----------+\n| def          | foo         | utf8                       | utf8_general_ci        | NULL     |\n+--------------+-------------+----------------------------+------------------------+----------+\n1 row in set (0.00 sec)\n")),(0,o.kt)("p",null,"\u3042\u308a\u307e\u3057\u305f\u3002"),(0,o.kt)("p",null,"\u3059\u308b\u3068 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform.tfstate")," \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ls\ndocker-compose.yml main.tf  terraform.tfstate\n")),(0,o.kt)("p",null,"\u3053\u3093\u306a JSON \u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": 4,\n  "terraform_version": "0.12.19",\n  "serial": 1,\n  "lineage": "7011a551-bfa1-96a5-4153-2c9d6f32251c",\n  "outputs": {},\n  "resources": [\n    {\n      "mode": "managed",\n      "type": "mysql_database",\n      "name": "foo",\n      "provider": "provider.mysql",\n      "instances": [\n        {\n          "schema_version": 0,\n          "attributes": {\n            "default_character_set": "utf8",\n            "default_collation": "utf8_general_ci",\n            "id": "foo",\n            "name": "foo"\n          },\n          "private": "bnVsbA=="\n        }\n      ]\n    }\n  ]\n}\n')),(0,o.kt)("p",null,"\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3068\u3001 Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\u306e\u30e1\u30bf\u60c5\u5831\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u57fa\u672c\u7684\u306b terraform \u306b\u3088\u3063\u3066\u66f4\u65b0\u3055\u308c\u308b\u3082\u306e\u3067\u3042\u308a\u3001\u4eba\u9593\u304c\u624b\u3067\u4fee\u6b63\u3059\u308b\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002"),(0,o.kt)("h2",{id:"\u53e4\u3044-terraform-\u3092\u4f7f\u3063\u3066\u307f\u308b"},"\u53e4\u3044 Terraform \u3092\u4f7f\u3063\u3066\u307f\u308b"),(0,o.kt)("p",null,"\u3053\u3053\u3067\u3042\u3048\u3066\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e Terraform \u3092\u4f7f\u3063\u3066 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ echo 0.12.12 > .terraform-version\n$ tfenv install\n$ terraform version\n$ terraform plan\nError: Error locking state: Error acquiring the state lock: state snapshot was created by Terraform v0.12.19, which is newer than current v0.12.12; upgrade to Terraform v0.12.19 or greater to work with this state\n\nTerraform acquires a state lock to protect the state from being written\nby multiple users at the same time. Please resolve the issue above and try\nagain. For most commands, you can disable locking with the "-lock=false"\nflag, but this is not recommended.\n')),(0,o.kt)("p",null,"\u5931\u6557\u3057\u307e\u3057\u305f\u3002 State \u306e lock \u306b\u5931\u6557\u3057\u305f\u3088\u3046\u3067\u3059\u3002 State \u306e lock \u306b\u3064\u3044\u3066\u306f ",(0,o.kt)("a",{parentName:"p",href:"https://techblog.szksh.cloud/terraform-state-locking/"},"https://techblog.szksh.cloud/terraform-state-locking/")," \u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),(0,o.kt)("p",null,"\u3053\u306e\u3088\u3046\u306b\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e terraform \u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\u4e00\u65b9\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4f7f\u3046\u306b\u306f\u554f\u984c\u306a\u304f\u4f7f\u3048\u307e\u3059\u304c\u3001 State \u306e ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform_version")," \u304c\u66f4\u65b0\u3055\u308c\u3001\u305d\u308c\u307e\u3067\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4f7f\u3063\u3066\u305f\u4eba\u304c\u7a81\u7136 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u306a\u3069\u304c\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002"),(0,o.kt)("p",null,"\u3053\u308c\u304c\u524d\u8ff0\u3057\u305f\u610f\u5473\u306b\u306a\u308a\u307e\u3059\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Terraform \u3092\u8907\u6570\u4eba\u3067\u4f7f\u3046\u5834\u5408\u3001 Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u63c3\u3048\u308b\u306e\u304c\u91cd\u8981\u3067\u3059\u3002 \u7406\u7531\u306e\u4e00\u3064\u3068\u3057\u3066\u3001 Terraform \u306e State \u306f State \u3092\u4f5c\u6210\u3057\u305f Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8a18\u9332\u3057\u3066\u304a\u308a\u3001\u305d\u308c\u3088\u308a\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e Terraform \u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u306a\u3069\u3092\u5b9f\u884c\u3059\u308b\u3068\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059(\u3053\u306e\u70b9\u306b\u3064\u3044\u3066\u306f\u5f8c\u3067\u3082\u89e6\u308c\u307e\u3059)\u3002")),(0,o.kt)("p",null,"\u3067\u306f\u5143\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u623b\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ echo 0.12.19 > .terraform-version\n$ terraform version\n$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("h2",{id:"\u30ea\u30bd\u30fc\u30b9\u306e\u66f4\u65b0"},"\u30ea\u30bd\u30fc\u30b9\u306e\u66f4\u65b0"),(0,o.kt)("p",null,"\u540c\u3058\u8abf\u5b50\u3067\u3082\u3046\u4e00\u3064 Database \u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nDatabase foo \u306e\u8a2d\u5b9a\u3092\u30b3\u30d4\u30fc\u3057\u3066 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name = "foo"\n}\n\nresource "mysql_database" "foo" {\n  name = "foo"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\n\nError: Duplicate resource "mysql_database" configuration\n\n  on main.tf line 11:\n  11: resource "mysql_database" "foo" {\n\nA mysql_database resource named "foo" was already declared at main.tf:7,1-32.\nResource names must be unique per type in each module.\n')),(0,o.kt)("p",null,"\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u901a\u308a\u3001\u30ea\u30bd\u30fc\u30b9\u30d1\u30b9\u306f\u30e6\u30cb\u30fc\u30af\u3067\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\n\u4fee\u6b63\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name = "foo"\n}\n\nresource "mysql_database" "bar" { # "foo" \u3092 "bar" \u306b\u5909\u66f4\n  name = "foo"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.bar will be created\n  + resource "mysql_database" "bar" {\n      + default_character_set = "utf8"\n      + default_collation     = "utf8_general_ci"\n      + id                    = (known after apply)\n      + name                  = "foo"\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n')),(0,o.kt)("p",null,"\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002 apply \u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform apply\nmysql_database.bar: Creating...\n\nError: Error 1007: Can\'t create database \'foo\'; database exists\n\n  on main.tf line 11, in resource "mysql_database" "bar":\n  11: resource "mysql_database" "bar" {\n')),(0,o.kt)("p",null,"\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u540c\u3058\u540d\u524d\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u4f5c\u6210\u3067\u304d\u306a\u3044\u306e\u3067\u5f53\u7136\u3067\u3059\u3002\n\u3053\u306e\u3088\u3046\u306b plan \u306b\u6210\u529f\u3057\u3066\u3082 apply \u306b\u5931\u6557\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u3059\u3002"),(0,o.kt)("p",null,"\u3067\u306f name \u3092\u4fee\u6b63\u3057\u307e\u3057\u3087\u3046\u3002\u3064\u3044\u3067\u306b database foo \u306e default character set \u3092\u4fee\u6b63\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name                  = "foo"\n  default_character_set = "utf8mb4" # default character set \u3092\u4fee\u6b63\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f utf8\n}\n\nresource "mysql_database" "bar" {\n  name = "bar" # \u540d\u524d\u3092 foo \u304b\u3089 bar \u306b\u5909\u66f4\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.bar will be created\n  + resource "mysql_database" "bar" {\n      + default_character_set = "utf8"\n      + default_collation     = "utf8_general_ci"\n      + id                    = (known after apply)\n      + name                  = "bar"\n    }\n\n  # mysql_database.foo will be updated in-place\n  ~ resource "mysql_database" "foo" {\n      ~ default_character_set = "utf8" -> "utf8mb4"\n        default_collation     = "utf8_general_ci"\n        id                    = "foo"\n        name                  = "foo"\n    }\n\nPlan: 1 to add, 1 to change, 0 to destroy.\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform apply\nmysql_database.bar: Creating...\nmysql_database.foo: Modifying... [id=foo]\nmysql_database.bar: Creation complete after 0s [id=bar]\n\nError: Error 1253: COLLATION \'utf8_general_ci\' is not valid for CHARACTER SET \'utf8mb4\'\n\n  on main.tf line 7, in resource "mysql_database" "foo":\n   7: resource "mysql_database" "foo" {\n')),(0,o.kt)("p",null,"mysql_database.foo \u306e\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u4e00\u65b9 mysql_database.bar \u306e\u4f5c\u6210\u306b\u306f\u6210\u529f\u3057\u3066\u3044\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| bar                |\n| foo                |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n6 rows in set (0.00 sec)\n\nmysql> select * from INFORMATION_SCHEMA.SCHEMATA where SCHEMA_NAME='foo';\n+--------------+-------------+----------------------------+------------------------+----------+\n| CATALOG_NAME | SCHEMA_NAME | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |\n+--------------+-------------+----------------------------+------------------------+----------+\n| def          | foo         | utf8                       | utf8_general_ci        | NULL     |\n+--------------+-------------+----------------------------+------------------------+----------+\n1 row in set (0.00 sec)\n")),(0,o.kt)("p",null,"\u3053\u306e\u3088\u3046\u306b\u3001\u4e00\u90e8\u306e\u5909\u66f4\u306e\u9069\u7528\u306b\u5931\u6557\u306b\u3057\u3066\u3082\u3001\u305d\u306e\u4ed6\u306e\u5909\u66f4\u306f\u9069\u7528\u3055\u308c\u308b\u3068\u3044\u3046\u3001\u3042\u308b\u610f\u5473\u4e2d\u9014\u534a\u7aef\u306b apply \u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3046\u3044\u3063\u305f\u5834\u5408\u306b rollback \u3059\u308b\u3088\u3046\u306a\u30b3\u30de\u30f3\u30c9\u306f\u306a\u3044\u306e\u3067\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3002\u9069\u7528\u3055\u308c\u305f\u5909\u66f4\u306f\u3061\u3083\u3093\u3068 State \u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),(0,o.kt)("p",null,"\u3067\u306f mysql_database.foo \u306e\u5909\u66f4\u306b\u5931\u6557\u3057\u305f\u306e\u3067\u3001\u9069\u5207\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name                  = "foo"\n  default_character_set = "utf8mb4"\n  default_collation     = "utf8mb4_general_ci" # utf8_general_ci \u304b\u3089\u5909\u66f4\n}\n')),(0,o.kt)("p",null,"apply \u306b ",(0,o.kt)("inlineCode",{parentName:"p"},"--auto-approve")," \u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u78ba\u8a8d\u306a\u3057\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002CI\u3067\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306f\u57fa\u672c\u3053\u308c\u3092\u3064\u3051\u308b\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform apply --auto-approve\nmysql_database.foo: Refreshing state... [id=foo]\nmysql_database.bar: Refreshing state... [id=bar]\nmysql_database.foo: Modifying... [id=foo]\nmysql_database.foo: Modifications complete after 0s [id=foo]\n\nApply complete! Resources: 0 added, 1 changed, 0 destroyed.\n")),(0,o.kt)("p",null,"\u5909\u66f4\u3067\u304d\u307e\u3057\u305f\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> select * from INFORMATION_SCHEMA.SCHEMATA where SCHEMA_NAME='foo';\n+--------------+-------------+----------------------------+------------------------+----------+\n| CATALOG_NAME | SCHEMA_NAME | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |\n+--------------+-------------+----------------------------+------------------------+----------+\n| def          | foo         | utf8mb4                    | utf8mb4_general_ci     | NULL     |\n+--------------+-------------+----------------------------+------------------------+----------+\n1 row in set (0.00 sec)\n")),(0,o.kt)("h2",{id:"terraformtfstatebackup"},"terraform.tfstate.backup"),(0,o.kt)("p",null,"\u3068\u3053\u308d\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform.tfstate.backup")," \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ls\ndocker-compose.yml main.tf  terraform.tfstate  terraform.state.backup\n")),(0,o.kt)("p",null,"\u3053\u308c\u306f\u540d\u524d\u306e\u901a\u308a ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform.tfstate")," \u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3067\u3059\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"terraform.tfstate")," \u304c terraform \u306e\u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u66f4\u65b0\u3055\u308c\u308b\u524d\u306b\u81ea\u52d5\u7684\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002"),(0,o.kt)("h2",{id:"\u30ea\u30bd\u30fc\u30b9\u306e-recreate"},"\u30ea\u30bd\u30fc\u30b9\u306e recreate"),(0,o.kt)("p",null,"\u4eca\u5ea6\u306f database \u306e\u540d\u524d\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name                  = "foo2" # foo \u304b\u3089\u5909\u66f4\n  default_character_set = "utf8mb4"\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.foo must be replaced\n-/+ resource "mysql_database" "foo" {\n        default_character_set = "utf8mb4"\n        default_collation     = "utf8mb4_general_ci"\n      ~ id                    = "foo" -> (known after apply)\n      ~ name                  = "foo" -> "foo2" # forces replacement\n    }\n\nPlan: 1 to add, 0 to change, 1 to destroy.\n')),(0,o.kt)("p",null,"\u5148\u7a0b default_collation \u3068 default_character_set \u3092\u5909\u66f4\u3057\u305f\u969b\u306f\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u4eca\u5ea6\u306f\u65b0\u3057\u304f\u4f5c\u308a\u76f4\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u308c\u306f\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/terraform-providers/terraform-provider-mysql/blob/v1.9.0/mysql/resource_database.go#L31"},"https://github.com/terraform-providers/terraform-provider-mysql/blob/v1.9.0/mysql/resource_database.go#L31")),(0,o.kt)("p",null,"\u5c5e\u6027\u306e\u5b9a\u7fa9\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"ForceNew: true")," \u3068\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u305d\u306e\u5c5e\u6027\u304c\u5909\u66f4\u3055\u308c\u308b\u3068\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u308a\u76f4\u3055\u308c\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u66f4\u65b0\u306b\u306a\u308a\u307e\u3059\u3002\n\u65b0\u3057\u304f\u4f5c\u308a\u76f4\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u306a\u3069\u306f\u6d88\u3048\u308b\u306f\u305a\u3067\u3059\u3002\u8a66\u3057\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u3063\u3066\u304a\u3044\u3066\u3001 apply \u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show tables from foo;\nEmpty set (0.00 sec)\n\nmysql> create table foo.zoo (id int);\nQuery OK, 0 rows affected (0.03 sec)\n\nmysql> show tables from foo;\n+---------------+\n| Tables_in_foo |\n+---------------+\n| zoo           |\n+---------------+\n1 row in set (0.00 sec)\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform apply --auto-approve\nmysql_database.foo: Refreshing state... [id=foo]\nmysql_database.bar: Refreshing state... [id=bar]\nmysql_database.foo: Destroying... [id=foo]\nmysql_database.foo: Destruction complete after 0s\nmysql_database.foo: Creating...\nmysql_database.foo: Creation complete after 0s [id=foo2]\n\nApply complete! Resources: 1 added, 0 changed, 1 destroyed.\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"mysql_database.foo: Destroying... ","[id=foo]")),(0,o.kt)("p",null,"\u3068\u3042\u308b\u3088\u3046\u306b\u4e00\u5ea6\u524a\u9664\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show tables from foo;\nERROR 1049 (42000): Unknown database 'foo'\nmysql> show tables from foo2;\nEmpty set (0.00 sec)\n")),(0,o.kt)("p",null,"\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u306f\u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u306e\u3088\u3046\u306b recreate \u306f\u5371\u967a\u306a\u64cd\u4f5c\u306a\u306e\u3067\u3084\u308b\u3068\u304d\u306b\u306f\u6ce8\u610f\u3092\u6255\u3044\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("h2",{id:"\u5909\u6570\u306e\u5229\u7528"},"\u5909\u6570\u306e\u5229\u7528"),(0,o.kt)("p",null,"\u5909\u6570\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u8a2d\u5b9a\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name                  = "foo2"\n  default_character_set = var.default_character_set  # \u5909\u6570 default_character_set \u3092\u53c2\u7167\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\n\nError: Reference to undeclared input variable\n\n  on main.tf line 9, in resource "mysql_database" "foo":\n   9:   default_character_set = var.default_character_set\n\nAn input variable with the name "default_character_set" has not been declared.\nThis variable can be declared with a variable "default_character_set" {}\nblock.\n')),(0,o.kt)("p",null,"\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u5909\u6570\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u5ba3\u8a00\u304c\u5fc5\u8981\u3067\u3059\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"variables.tf")," \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'variable "default_character_set" {\n  type = string\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nvar.default_character_set\n  Enter a value:\n")),(0,o.kt)("p",null,"\u5024\u306e\u5165\u529b\u3092\u6c42\u3081\u3089\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u5909\u6570\u306e\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f ",(0,o.kt)("inlineCode",{parentName:"p"},"foo")," \u3068\u5165\u529b\u3057\u3066\u307f\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nvar.default_character_set\n  Enter a value: foo\n\nTerraform will perform the following actions:\n\n  # mysql_database.foo will be updated in-place\n  ~ resource "mysql_database" "foo" {\n      ~ default_character_set = "utf8mb4" -> "foo"\n        default_collation     = "utf8mb4_general_ci"\n        id                    = "foo2"\n        name                  = "foo2"\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"-input=false")," \u306b\u3059\u308b\u3068\u5165\u529b\u3092\u6c42\u3081\u3089\u308c\u305a\u306b\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan -input=false\n\nError: No value for required variable\n\n  on variables.tf line 1:\n   1: variable "default_character_set" {\n\nThe root module input variable "default_character_set" is not set, and has no\ndefault value. Use a -var or -var-file command line argument to provide a\nvalue for this variable.\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"terraform.tfvars")," \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u5024\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'default_character_set = "utf8mb4"\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\n\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"terraform.tfvars")," \u306f\u7279\u5225\u306a\u30d5\u30a1\u30a4\u30eb\u540d\u3067\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3068\u81ea\u52d5\u3067\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059\u3002"),(0,o.kt)("p",null,"\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5909\u3048\u3066 terraform plan \u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ mv terraform.tfvars main.tfvars\n$ terraform plan\nvar.default_character_set\n  Enter a value:\n")),(0,o.kt)("p",null,"\u805e\u304b\u308c\u307e\u3057\u305f\u3002 main.tfvars \u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002 ",(0,o.kt)("inlineCode",{parentName:"p"},"-var-file")," \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308c\u3070 main.tfvars \u3092\u8aad\u307f\u8fbc\u3081\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan -var-file=main.tfvars\n")),(0,o.kt)("p",null,"\u3082\u3068\u306b\u623b\u3057\u3066\u304a\u304d\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ mv main.tfvars terraform.tfvars\n")),(0,o.kt)("h2",{id:"\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5c5e\u6027\u306e\u53c2\u7167"},"\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5c5e\u6027\u306e\u53c2\u7167"),(0,o.kt)("p",null,"\u8a2d\u5b9a\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo" {\n  name                  = "foo2"\n  default_character_set = var.default_character_set\n  default_collation     = "utf8mb4_general_ci"\n}\n\nresource "mysql_database" "bar" {\n  name                  = "bar"\n  default_character_set = mysql_database.foo.default_character_set  # \u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5c5e\u6027\u3092\u53c2\u7167\n  default_collation     = "utf8mb4_general_ci"  # default_character_set \u306b\u5408\u308f\u305b\u3066\u5909\u66f4\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.bar will be updated in-place\n  ~ resource "mysql_database" "bar" {\n      ~ default_character_set = "utf8" -> "utf8mb4"\n      ~ default_collation     = "utf8_general_ci" -> "utf8mb4_general_ci"\n        id                    = "bar"\n        name                  = "bar"\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform apply --auto-approve\nmysql_database.foo: Refreshing state... [id=foo2]\nmysql_database.bar: Refreshing state... [id=bar]\nmysql_database.bar: Modifying... [id=bar]\nmysql_database.bar: Modifications complete after 0s [id=bar]\n\nApply complete! Resources: 0 added, 1 changed, 0 destroyed.\n")),(0,o.kt)("h2",{id:"terraform-state-rm"},"terraform state rm"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/commands/state/rm.html"},"https://www.terraform.io/docs/commands/state/rm.html")),(0,o.kt)("p",null,"Terraform \u306f State \u306b\u3088\u3063\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u30ea\u30bd\u30fc\u30b9\u3068\u5b9f\u969b\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u3002\nState \u304b\u3089\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001 Terraform \u306f\u305d\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u65b0\u898f\u3067\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nNo changes. Infrastructure is up-to-date.\n\n$ terraform state rm mysql_database.bar\nRemoved mysql_database.bar\nSuccessfully removed 1 resource instance(s).\n\n$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.bar will be created\n  + resource "mysql_database" "bar" {\n      + default_character_set = "utf8mb4"\n      + default_collation     = "utf8mb4_general_ci"\n      + id                    = (known after apply)\n      + name                  = "bar"\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n')),(0,o.kt)("p",null,"\u5b9f\u969b\u306b\u306f\u540c\u3058\u540d\u524d\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u4f5c\u6210\u3067\u304d\u306a\u3044\u306e\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"apply")," \u3067\u5931\u6557\u3059\u308b\u306f\u305a\u3067\u3059\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"terraform state rm")," \u306f\u5143\u3005 Terraform \u3067\u7ba1\u7406\u3057\u3066\u3044\u305f\u3082\u306e\u3092 Terraform \u3067\u7ba1\u7406\u3059\u308b\u306e\u3092\u6b62\u3081\u305f\u308a\u3001\u3042\u308b\u3044\u306f\u624b\u52d5\u3067\u524a\u9664\u3057\u3066\u3057\u307e\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u3092 State \u304b\u3089\u3082\u524a\u9664\u3059\u308b\u306e\u306b\u4f7f\u3048\u307e\u3059\u3002"),(0,o.kt)("h2",{id:"terraform-import"},"terraform import"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/import/index.html"},"https://www.terraform.io/docs/import/index.html"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/commands/import.html"},"https://www.terraform.io/docs/commands/import.html")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"terraform import")," \u306f Terraform \u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u3092 Terraform \u3067\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b State \u306b\u30ea\u30bd\u30fc\u30b9\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u3080\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\u3061\u3087\u3046\u3069 ",(0,o.kt)("inlineCode",{parentName:"p"},"mysql_database.bar")," \u3092 State \u304b\u3089\u6d88\u3057\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001 import \u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/providers/mysql/r/database.html#import"},"https://www.terraform.io/docs/providers/mysql/r/database.html#import")," \u306b\u3042\u308b\u901a\u308a\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u3092\u6307\u5b9a\u3059\u308c\u3070 import \u51fa\u6765\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform import mysql_database.bar bar\nmysql_database.bar: Importing from ID "bar"...\nmysql_database.bar: Import prepared!\n  Prepared mysql_database for import\nmysql_database.bar: Refreshing state... [id=bar]\n\nImport successful!\n\nThe resources that were imported are shown above. These resources are now in\nyour Terraform state and will henceforth be managed by Terraform.\n')),(0,o.kt)("p",null,"Import \u51fa\u6765\u307e\u3057\u305f\u3002 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u3066\u5dee\u5206\u304c\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("p",null,"\u6b21\u306b\u624b\u52d5\u3067 Database \u3092\u4f5c\u6210\u3057\u3066\u305d\u308c\u3092 import \u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> create database zoo;\nQuery OK, 1 row affected (0.00 sec)\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform import mysql_database.zoo zoo\nError: resource address "mysql_database.zoo" does not exist in the configuration.\n\nBefore importing this resource, please create its configuration in the root module. For example:\n\nresource "mysql_database" "zoo" {\n  # (resource arguments)\n}\n')),(0,o.kt)("p",null,"\u5931\u6557\u3057\u307e\u3057\u305f\u3002 ",(0,o.kt)("inlineCode",{parentName:"p"},"mysql_database.zoo")," \u304c\u5b58\u5728\u3057\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n\u7a7a\u3067\u826f\u3044\u306e\u3067\u30ea\u30bd\u30fc\u30b9\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "zoo" {\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform import mysql_database.zoo zoo\nmysql_database.zoo: Importing from ID "zoo"...\nmysql_database.zoo: Import prepared!\n  Prepared mysql_database for import\nmysql_database.zoo: Refreshing state... [id=zoo]\n\nImport successful!\n\nThe resources that were imported are shown above. These resources are now in\nyour Terraform state and will henceforth be managed by Terraform.\n')),(0,o.kt)("p",null,"Import \u51fa\u6765\u305f\u306e\u3067 zoo \u3092 Terraform \u3067\u7ba1\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\n\nError: Missing required argument\n\n  on main.tf line 19, in resource "mysql_database" "zoo":\n  19: resource "mysql_database" "zoo" {\n\nThe argument "name" is required, but no definition was found.\n')),(0,o.kt)("p",null,"zoo \u306e\u8a2d\u5b9a\u304c\u7a7a\u3067 name \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u4fee\u6b63\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "zoo" {\n  name = "zoo"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.zoo will be updated in-place\n  ~ resource "mysql_database" "zoo" {\n      ~ default_character_set = "latin1" -> "utf8"\n      ~ default_collation     = "latin1_swedish_ci" -> "utf8_general_ci"\n        id                    = "zoo"\n        name                  = "zoo"\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n')),(0,o.kt)("p",null,"\u307e\u3060\u5dee\u5206\u304c\u51fa\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002"),(0,o.kt)("p",null,"Import \u306f State \u306b\u306f\u30ea\u30bd\u30fc\u30b9\u306e\u30c7\u30fc\u30bf\u3092\u53cd\u6620\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u53cd\u6620\u3057\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u81ea\u5206\u3067\u53cd\u6620\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4e00\u90e8\u306e Provider \u3067\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u81ea\u52d5\u3067\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306e\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u30c4\u30fc\u30eb\u3082\u3042\u308a\u307e\u3059\u3002"),(0,o.kt)("p",null,"\u4fee\u6b63\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "zoo" {\n  name                  = "zoo"\n  default_character_set = "latin1"\n  default_collation     = "latin1_swedish_ci"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("p",null,"\u7121\u4e8b\u5dee\u5206\u304c\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002"),(0,o.kt)("h2",{id:"\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664"},"\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664"),(0,o.kt)("p",null,"\u6b21\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"terraform destroy")," \u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8a2d\u5b9a\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b Terraform \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a18\u8ff0\u8a00\u8a9e\u3067\u3042\u308b HCL \u3067\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u306f ",(0,o.kt)("inlineCode",{parentName:"p"},"#")," \u3067\u3082 ",(0,o.kt)("inlineCode",{parentName:"p"},"//")," \u3067\u3082\u3069\u3061\u3089\u3067\u3082\u826f\u3044\u3067\u3059\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/hcl#syntax"},"https://github.com/hashicorp/hcl#syntax")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'# resource "mysql_database" "bar" {\n#   name                  = "bar"\n#   default_character_set = mysql_database.foo.default_character_set\n#   default_collation     = "utf8mb4_general_ci"\n# }\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.bar will be destroyed\n  - resource "mysql_database" "bar" {\n      - default_character_set = "utf8mb4" -> null\n      - default_collation     = "utf8mb4_general_ci" -> null\n      - id                    = "bar" -> null\n      - name                  = "bar" -> null\n    }\n\nPlan: 0 to add, 0 to change, 1 to destroy.\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform apply --auto-approve\nmysql_database.foo: Refreshing state... [id=foo2]\nmysql_database.bar: Refreshing state... [id=bar]\nmysql_database.bar: Destroying... [id=bar]\nmysql_database.bar: Destruction complete after 0s\n\nApply complete! Resources: 0 added, 0 changed, 1 destroyed.\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| foo2               |\n| mysql              |\n| performance_schema |\n| sys                |\n| zoo                |\n+--------------------+\n6 rows in set (0.00 sec)\n")),(0,o.kt)("p",null,"\u78ba\u304b\u306b\u524a\u9664\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),(0,o.kt)("h2",{id:"terraform-state-mv"},"terraform state mv"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/commands/state/mv.html"},"https://www.terraform.io/docs/commands/state/mv.html")),(0,o.kt)("p",null,"\u3053\u3053\u3067 \u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d\u3092\u5909\u3048\u3066 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u540d\u524d\u3092\u5909\u3048\u305f\u304f\u306a\u308b\u3053\u3068\u306f\u307e\u3041\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "foo2" { # foo \u304b\u3089 foo2 \u306b\u5909\u66f4\n  name                  = "foo2"\n  default_character_set = var.default_character_set\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.foo will be destroyed\n  - resource "mysql_database" "foo" {\n      - default_character_set = "utf8mb4" -> null\n      - default_collation     = "utf8mb4_general_ci" -> null\n      - id                    = "foo2" -> null\n      - name                  = "foo2" -> null\n    }\n\n  # mysql_database.foo2 will be created\n  + resource "mysql_database" "foo2" {\n      + default_character_set = "utf8mb4"\n      + default_collation     = "utf8mb4_general_ci"\n      + id                    = (known after apply)\n      + name                  = "foo2"\n    }\n\nPlan: 1 to add, 0 to change, 1 to destroy.\n')),(0,o.kt)("p",null,"\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u524a\u9664\u3055\u308c\u3066\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u305d\u3046\u3067\u3059\u3002\nState \u306b\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30d1\u30b9\u3092\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform state mv mysql_database.foo mysql_database.foo2\nMove "mysql_database.foo" to "mysql_database.foo2"\nSuccessfully moved 1 object(s).\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("p",null,"\u5dee\u5206\u304c\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002"),(0,o.kt)("p",null,"\u3053\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066 State \u3092\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u7279\u306b\u8907\u6570\u4eba\u3067\u4f5c\u696d\u3059\u308b\u5834\u5408\u306f\u5b89\u6613\u306b\u30ea\u30bd\u30fc\u30b9\u30d1\u30b9\u3092\u5909\u66f4\u3059\u308b\u3079\u304d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002"),(0,o.kt)("h2",{id:"terraform-refresh"},"terraform refresh"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/commands/refresh.html"},"https://www.terraform.io/docs/commands/refresh.html")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"terraform refresh")," \u306f\u5b9f\u969b\u306e\u30a4\u30f3\u30d5\u30e9\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066 State \u306b\u53cd\u6620\u3055\u305b\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\nTerraform \u3092\u4f7f\u308f\u305a\u306b\u52a0\u3048\u305f\u5909\u66f4\u3092 State \u306b\u53cd\u6620\u3055\u305b\u308b\u306e\u306b\u4f7f\u3048\u307e\u3059\u3002\nTerraform \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30d5\u30e9\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u4ee5\u4e0a\u3001 Terraform \u3092\u4f7f\u308f\u305a\u306b\u30a4\u30f3\u30d5\u30e9\u3092\u5909\u66f4\u3059\u308b\u306e\u306f\u671b\u307e\u3057\u304f\u306a\u3044\u3067\u3059\u304c\u3001\u5b9f\u969b\u306e\u3068\u3053\u308d\u306f\u3088\u304f\u3042\u308b\u8a71\u304b\u3068\u601d\u3044\u307e\u3059\u3002"),(0,o.kt)("p",null,"Terraform \u3092\u4f7f\u308f\u305a\u306b default_character_set \u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> ALTER DATABASE zoo DEFAULT CHARACTER SET utf8mb4;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> select * from INFORMATION_SCHEMA.SCHEMATA where SCHEMA_NAME='zoo';\n+--------------+-------------+----------------------------+------------------------+----------+\n| CATALOG_NAME | SCHEMA_NAME | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |\n+--------------+-------------+----------------------------+------------------------+----------+\n| def          | zoo         | utf8mb4                    | utf8mb4_general_ci     | NULL     |\n+--------------+-------------+----------------------------+------------------------+----------+\n1 row in set (0.00 sec)\n")),(0,o.kt)("p",null,"default_character_set \u3092\u5909\u3048\u308b\u3068\u81ea\u52d5\u3067 DEFAULT_COLLATION_NAME \u3082\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u3082\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "zoo" {\n  name                  = "zoo"\n  default_character_set = "utf8mb4"\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"-refresh=false")," \u3092\u3064\u3051\u3066 terraform plan \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan -refresh=false\nTerraform will perform the following actions:\n\n  # mysql_database.zoo will be updated in-place\n  ~ resource "mysql_database" "zoo" {\n      ~ default_character_set = "latin1" -> "utf8mb4"\n      ~ default_collation     = "latin1_swedish_ci" -> "utf8mb4_general_ci"\n        id                    = "zoo"\n        name                  = "zoo"\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n\nWarning: Resource targeting is in effect\n\nYou are creating a plan with the -target option, which means that the result\nof this plan may not represent all of the changes requested by the current\nconfiguration.\n\nThe -target option is not for routine use, and is provided only for\nexceptional situations such as recovering from errors or mistakes, or when\nTerraform specifically suggests to use it as part of an error message.\n')),(0,o.kt)("p",null,"\u5dee\u5206\u304c\u51fa\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f State \u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u306a\u3044\u304b\u3089\u3067\u3059\u3002\nterraform.tfstate \u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'    {\n      "mode": "managed",\n      "type": "mysql_database",\n      "name": "zoo",\n      "provider": "provider.mysql",\n      "instances": [\n        {\n          "schema_version": 0,\n          "attributes": {\n            "default_character_set": "latin1",\n            "default_collation": "latin1_swedish_ci",\n            "id": "zoo",\n            "name": "zoo"\n          },\n          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjAifQ=="\n        }\n      ]\n    }\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"-refresh=false")," \u3092\u53d6\u308b\u3068\u4eca\u5ea6\u306f\u5dee\u5206\u304c\u306a\u304f\u306a\u308b\u306f\u305a\u3067\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("p",null,"\u3053\u308c\u306f\u3001\u5b9f\u306f terraform plan \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f State \u306e\u5185\u5bb9\u3068\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6bd4\u8f03\u3059\u308b\u524d\u306b\u5b9f\u969b\u306e\u30a4\u30f3\u30d5\u30e9\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057 State \u306e\u5185\u5bb9\u3092\u30a4\u30f3\u30e1\u30e2\u30ea\u3067\u66f4\u65b0\u3057\u305f\u4e0a\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u6bd4\u8f03\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n\u305f\u3060\u3057\u3001\u30a4\u30f3\u30e1\u30e2\u30ea\u3067\u306e\u66f4\u65b0\u3067\u3042\u308a\u3001\u5b9f\u969b\u306e State \u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u3067\u3059\u3002"),(0,o.kt)("p",null,"\u4eca\u307e\u3067\u30b9\u30eb\u30fc\u3057\u3066\u304d\u307e\u3057\u305f\u304c\u3001\u305d\u306e\u3053\u3068\u306f terraform plan \u306e\u7d50\u679c\u3067\u3082\u8aac\u660e\u3055\u308c\u3066\u3044\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but will not be\npersisted to local or remote state storage.\n")),(0,o.kt)("p",null,"\u3067\u306f\u306a\u3093\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"-refresh=false")," \u304c\u5fc5\u8981\u306b\u306a\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u7406\u7531\u306e\u4e00\u3064\u3068\u3057\u3066 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u304c\u901f\u304f\u306a\u308b\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002\n\u3080\u3057\u308d ",(0,o.kt)("inlineCode",{parentName:"p"},"-refresh=false")," \u3092\u3064\u3051\u306a\u3044\u3068\u3001\u7ba1\u7406\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u6570\u304c\u5897\u3048\u308c\u3070\u5897\u3048\u308b\u307b\u3069\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u304f\u308b\u306e\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3057\u3001\n\u5834\u5408\u306b\u3088\u3063\u3066\u306f API \u306e rate limit \u306b\u5f15\u3063\u304b\u304b\u308b\u306a\u3093\u3066\u3053\u3068\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002"),(0,o.kt)("p",null,"\u306a\u306e\u3067\u666e\u6bb5 ",(0,o.kt)("inlineCode",{parentName:"p"},"-refresh=false")," \u3092\u3064\u3051\u3066 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3068 Terraform \u3092\u4f7f\u308f\u305a\u306b\u52a0\u3048\u305f\u30a4\u30f3\u30d5\u30e9\u306e\u4fee\u6b63\u3092 State \u306b\u53d6\u308a\u8fbc\u3080\u305f\u3081\u306b ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform refresh")," \u3092\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u51fa\u3066\u304d\u305f\u308a\u3057\u307e\u3059\u3002"),(0,o.kt)("p",null,"State \u306f\u66f4\u65b0\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"-refresh=false")," \u3068\u3059\u308c\u3070\u76f8\u5909\u308f\u3089\u305a\u5dee\u5206\u306f\u51fa\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan -refresh=false\nTerraform will perform the following actions:\n\n  # mysql_database.zoo will be updated in-place\n  ~ resource "mysql_database" "zoo" {\n      ~ default_character_set = "utf8mb4" -> "latin1"\n      ~ default_collation     = "utf8mb4_general_ci" -> "latin1_swedish_ci"\n        id                    = "zoo"\n        name                  = "zoo"\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n')),(0,o.kt)("p",null,"\u5dee\u5206\u304c\u51fa\u307e\u3057\u305f\u3002 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform refresh")," \u3092\u5b9f\u884c\u3059\u308b\u3068 State \u304c\u66f4\u65b0\u3055\u308c\u3001\u5dee\u5206\u304c\u306a\u304f\u306a\u308b\u306f\u305a\u3067\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform refresh\nmodule.app.mysql_database.db: Refreshing state... [id=app]\nmysql_database.foo2: Refreshing state... [id=foo2]\nmysql_database.zoo: Refreshing state... [id=zoo]\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'    {\n      "mode": "managed",\n      "type": "mysql_database",\n      "name": "zoo",\n      "provider": "provider.mysql",\n      "instances": [\n        {\n          "schema_version": 0,\n          "attributes": {\n            "default_character_set": "utf8mb4",\n            "default_collation": "utf8mb4_general_ci",\n            "id": "zoo",\n            "name": "zoo"\n          },\n          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjAifQ=="\n        }\n      ]\n    }\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan -refresh=false\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("h2",{id:"module"},"Module"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/configuration/modules.html"},"https://www.terraform.io/docs/configuration/modules.html")),(0,o.kt)("p",null,"\u7c21\u5358\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ mkdir database\nvi database/database.tf\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "db" {\n  name                  = "app"\n  default_character_set = "utf8mb4"\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("p",null,"\u3067\u306f Module \u3092\u4f7f\u3063\u3066 database \u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'module "app" {\n  source = "./database"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nError: Module not installed\n\n  on main.tf line 25:\n  25: module "app" {\n\nThis module is not yet installed. Run "terraform init" to install all modules\nrequired by this configuration.\n')),(0,o.kt)("p",null,"\u5931\u6557\u3057\u307e\u3057\u305f\u3002 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform init")," \u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform init\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # module.app.mysql_database.db will be created\n  + resource "mysql_database" "db" {\n      + default_character_set = "utf8mb4"\n      + default_collation     = "utf8mb4_general_ci"\n      + id                    = (known after apply)\n      + name                  = "app"\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform apply --auto-approve\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n")),(0,o.kt)("h3",{id:"module-\u30d1\u30e9\u30e1\u30fc\u30bf"},"Module \u30d1\u30e9\u30e1\u30fc\u30bf"),(0,o.kt)("p",null,'\u3053\u308c\u3067 Module \u3092\u4f7f\u3063\u3066 Database \u3092\u4f5c\u308c\u307e\u3057\u305f\u304c\u3001 name \u304c "app" \u56fa\u5b9a\u306a\u306e\u3067\u4f7f\u3044\u3065\u3089\u3044\u3067\u3059\u306d\u3002\u540d\u524d\u3092\u5909\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002'),(0,o.kt)("p",null,"database/database.tf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "db" {\n  name                  = var.name\n  default_character_set = "utf8mb4"\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("p",null,"database/variables.tf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'variable "name" {\n  type = string\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\n\nError: Missing required argument\n\n  on main.tf line 25, in module "app":\n  25: module "app" {\n\nThe argument "name" is required, but no definition was found.\n')),(0,o.kt)("p",null,"\u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/configuration/variables.html"},"https://www.terraform.io/docs/configuration/variables.html")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'variable "name" {\n  type    = string\n  default = "app"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("p",null,"\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3057\u3066 name \u3092\u5909\u66f4\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'module "app" {\n  source = "./database"\n  name   = "app2"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # module.app.mysql_database.db must be replaced\n-/+ resource "mysql_database" "db" {\n        default_character_set = "utf8mb4"\n        default_collation     = "utf8mb4_general_ci"\n      ~ id                    = "app" -> (known after apply)\n      ~ name                  = "app" -> "app2" # forces replacement\n    }\n')),(0,o.kt)("p",null,"\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u305b\u307e\u3057\u305f\u3002\u3082\u3068\u306b\u623b\u3057\u3066\u304a\u304d\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'module "app" {\n  source = "./database"\n  name   = "app"\n}\n')),(0,o.kt)("h3",{id:"module-output"},"Module Output"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/configuration/outputs.html"},"https://www.terraform.io/docs/configuration/outputs.html")),(0,o.kt)("p",null,"mysql_database.bar \u304b\u3089 mysql_database.foo \u306e\u5c5e\u6027\u3092\u53c2\u7167\u3057\u305f\u3088\u3046\u306b\u3001 ",(0,o.kt)("inlineCode",{parentName:"p"},"module.app")," \u3067\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5c5e\u6027\u3092\u53c2\u7167\u3059\u308b\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3088\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\n\u30e2\u30b8\u30e5\u30fc\u30eb\u5185\u3067\u3042\u308c\u3070\u666e\u901a\u306b\u53c2\u7167\u3067\u304d\u307e\u3059\u304c\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5916\u304b\u3089\u53c2\u7167\u3059\u308b\u306b\u306f\u3001 Module \u5074\u3067\u660e\u793a\u7684\u306b\u516c\u958b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4e0d\u4fbf\u306a\u5074\u9762\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u30ab\u30d7\u30bb\u30eb\u5316\u3068\u3082\u8a00\u3048\u307e\u3059\u306d\u3002"),(0,o.kt)("p",null,"default_character_set \u3092\u516c\u958b\u3057\u307e\u3057\u3087\u3046\u3002"),(0,o.kt)("p",null,"database/output.tf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'output "default_character_set" {\n  value = mysql_database.db.default_character_set\n}\n')),(0,o.kt)("p",null,"\u305d\u3057\u3066\u53c2\u7167\u3057\u307e\u3059\u3002"),(0,o.kt)("p",null,"main.tf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "zoo" {\n  name                  = "zoo"\n  default_character_set = module.app.default_character_set  # \u53c2\u7167\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform plan\nNo changes. Infrastructure is up-to-date.\n")),(0,o.kt)("h2",{id:"terraform-destroy"},"terraform destroy"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/docs/commands/destroy.html"},"https://www.terraform.io/docs/commands/destroy.html")),(0,o.kt)("p",null,"\u3053\u3053\u307e\u3067\u304a\u75b2\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u6700\u5f8c\u306b\u3053\u308c\u307e\u3067\u4f5c\u3063\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"-target")," \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30ea\u30bd\u30fc\u30b9\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u7279\u5b9a\u306e\u30ea\u30bd\u30fc\u30b9\u3060\u3051\u524a\u9664\u3067\u304d\u307e\u3059\u3002\n",(0,o.kt)("inlineCode",{parentName:"p"},"-target")," \u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u8907\u6570\u56de\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u8907\u6570\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform destroy -target=module.app\n\nTerraform will perform the following actions:\n\n  # mysql_database.zoo will be destroyed\n  - resource "mysql_database" "zoo" {\n      - default_character_set = "utf8mb4" -> null\n      - default_collation     = "utf8mb4_general_ci" -> null\n      - id                    = "zoo" -> null\n      - name                  = "zoo" -> null\n    }\n\n  # module.app.mysql_database.db will be destroyed\n  - resource "mysql_database" "db" {\n      - default_character_set = "utf8mb4" -> null\n      - default_collation     = "utf8mb4_general_ci" -> null\n      - id                    = "app" -> null\n      - name                  = "app" -> null\n    }\n\nPlan: 0 to add, 0 to change, 2 to destroy.\n\nDo you really want to destroy all resources?\n  Terraform will destroy all your managed infrastructure, as shown above.\n  There is no undo. Only \'yes\' will be accepted to confirm.\n\n  Enter a value: yes\n')),(0,o.kt)("p",null,"module.app \u3092\u6d88\u305d\u3046\u3068\u3057\u305f\u3089\u3001 mysql_database.zoo \u3082\u524a\u9664\u3055\u308c\u305d\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306f mysql_database.zoo \u304c module.app \u306e\u5c5e\u6027\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hcl"},'resource "mysql_database" "zoo" {\n  name                  = "zoo"\n  default_character_set = module.app.default_character_set  # module.app \u306b\u4f9d\u5b58\n  default_collation     = "utf8mb4_general_ci"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"-target")," \u30aa\u30d7\u30b7\u30e7\u30f3\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"mysql_database.zoo")," \u3092\u6307\u5b9a\u3059\u308c\u3070\u305d\u308c\u3060\u3051\u524a\u9664\u3055\u308c\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform destroy -target=mysql_database.zoo\nTerraform will perform the following actions:\n\n  # mysql_database.zoo will be destroyed\n  - resource "mysql_database" "zoo" {\n      - default_character_set = "utf8mb4" -> null\n      - default_collation     = "utf8mb4_general_ci" -> null\n      - id                    = "zoo" -> null\n      - name                  = "zoo" -> null\n    }\n\nPlan: 0 to add, 0 to change, 1 to destroy.\n\nDo you really want to destroy all resources?\n  Terraform will destroy all your managed infrastructure, as shown above.\n  There is no undo. Only \'yes\' will be accepted to confirm.\n\n  Enter a value:\n')),(0,o.kt)("p",null,"\u78ba\u8a8d\u3055\u308c\u308b\u306e\u3067\u3001 yes \u3068\u5165\u529b\u3057\u3066\u524a\u9664\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"  Enter a value: yes\n\nmysql_database.zoo: Destroying... [id=zoo]\nmysql_database.zoo: Destruction complete after 0s\n\nWarning: Applied changes may be incomplete\n\nThe plan was created with the -target option in effect, so some changes\nrequested in the configuration may have been ignored and the output values may\nnot be fully updated. Run the following command to verify that no other\nchanges are pending:\n    terraform plan\n\nNote that the -target option is not suitable for routine use, and is provided\nonly for exceptional situations such as recovering from errors or mistakes, or\nwhen Terraform specifically suggests to use it as part of an error message.\n\n\nDestroy complete! Resources: 1 destroyed.\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| app                |\n| foo2               |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n6 rows in set (0.00 sec)\n")),(0,o.kt)("p",null,"\u78ba\u304b\u306b\u6d88\u3048\u3066\u3044\u307e\u3059\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u306f\u6d88\u3048\u3066\u3044\u306a\u3044\u306e\u3067 ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform plan")," \u3092\u5b9f\u884c\u3059\u308b\u3068 Create \u3057\u3088\u3046\u3068\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ terraform plan\nTerraform will perform the following actions:\n\n  # mysql_database.zoo will be created\n  + resource "mysql_database" "zoo" {\n      + default_character_set = "utf8mb4"\n      + default_collation     = "utf8mb4_general_ci"\n      + id                    = (known after apply)\n      + name                  = "zoo"\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n')),(0,o.kt)("p",null,"\u30ea\u30bd\u30fc\u30b9\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u5168\u3066\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3059\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ terraform destroy --auto-approve\nmodule.app.mysql_database.db: Refreshing state... [id=app]\nmysql_database.foo2: Refreshing state... [id=foo2]\nmysql_database.foo2: Destroying... [id=foo2]\nmodule.app.mysql_database.db: Destroying... [id=app]\nmodule.app.mysql_database.db: Destruction complete after 0s\nmysql_database.foo2: Destruction complete after 0s\n\nDestroy complete! Resources: 2 destroyed.\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n")),(0,o.kt)("p",null,"\u5168\u90e8\u6d88\u3048\u307e\u3057\u305f\u3002"))}c.isMDXComponent=!0}}]);