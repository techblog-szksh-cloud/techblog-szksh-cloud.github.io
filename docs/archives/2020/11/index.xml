<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>2020/11 on melody</title>
    <link>https://techblog.szksh.cloud/archives/2020/11/</link>
    <description>Recent content in 2020/11 on melody</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>jp</language><atom:link href="https://techblog.szksh.cloud/archives/2020/11/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>仕事でやったこと 2020-10-01 ~ 2020-10-31</title>
      <link>https://techblog.szksh.cloud/job-2020-10-01-10-31/</link>
      <pubDate>Sun, 29 Nov 2020 11:48:17 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/job-2020-10-01-10-31/</guid>
      <description>2020-10-01 から 2020-10-31 にかけて仕事でやったことを書きます。 勿論全部は書けないのでいくつかピックアップして書きます。
 Terraform  CodeBuild Batch Build による dynamic な build pipeline の導入 Conftest の実行方法を修正  https://www.openpolicyagent.org/docs/latest/terraform/ tf ファイルに対して conftest を実行するのではなく、公式の方法に従ってテストするようにした   aws_cloudwatch_log_group.retention_in_days が設定されているか Conftest でテスト  コスト削減   tfnotify が parse に失敗した場合、 github-comment でコメント  https://techblog.szksh.cloud/post-tfnotify-parse-error/     Docker Hub 認証するようにした  Docker Hub の Rate Limit 問題に対応した話   kustomize build のテスト(失敗したら PR にコメントをして、なぜ失敗したか分かるようにした)  元々 kustomize build に失敗して CI がこけても、なぜこけたのか分かりにくく、 SRE に問い合わせが来て調べるみたいなことがあった どの k8s manifest の kustomize build に失敗したのか、 PR に分かりやすくコメントするようにした   CI で kubectl apply &amp;ndash;server-dry-run によるテストを導入 Monorepo  差分検知・デプロイパイプラインの改善   Renovate  automerge の導入  renovate-approve 便利   CI で renovate-config-validator による validation の導入  https://docs.</description>
    </item>
    
    <item>
      <title>仕事でやったこと 2020-07-01 ~ 2020-09-30</title>
      <link>https://techblog.szksh.cloud/job-2020-07-01-09-30/</link>
      <pubDate>Sun, 29 Nov 2020 11:36:44 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/job-2020-07-01-09-30/</guid>
      <description>2020-07-01 から 2020-09-30 にかけて仕事でやったことを書きます。 勿論全部は書けないのでいくつかピックアップして書きます。
 Terraform  CircleCI から CodeBuild への移行  Security + DX 10月以降も継続   tfnotify の導入  Monorepo で導入するには一工夫が必要 コメントが消える挙動がドキュメント化されてなくて軽くハマった     Renovate の導入  Regex Manager 便利   Monorepo  差分検知・デプロイパイプラインの改善   DataDog からのアラートのハンドリング業務の改善  どんなアラートがあって、どう対応したかなどのナレッジの共有の改善 割とアナログな手法だが、ちゃんと work している    </description>
    </item>
    
    <item>
      <title>仕事でやったこと 2020-04-01 ~ 2020-06-30</title>
      <link>https://techblog.szksh.cloud/job-2020-04-01-06-30/</link>
      <pubDate>Sun, 29 Nov 2020 11:20:07 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/job-2020-04-01-06-30/</guid>
      <description>2020-04-01 から 2020-06-30 にかけて仕事でやったことを書きます。 勿論全部は書けないのでいくつかピックアップして書きます。
 Monorepo  CI で kustomize build の diff を PR にコメント Conftest で k8s manifest の validation の導入 Go で書かれた差分検知のコードのリファクタリング CI の高速化・コスト削減   GitOps  GitOps を導入するためのツールの開発のサポート   Terraform  input variables を local value に置き換え   GuardDuty の導入  Terraform で IaC False Positive なアラートが多くてハンドリングできてない   ブログの執筆  CI の修正をリリース前に本番と同じ条件下で検証出来る仕組みを構築した話   Argo Workflows の検証 MongoDB Atlas への移行サポート  Go で Restore Job の開発 オペレーション    </description>
    </item>
    
    <item>
      <title>仕事でやったこと 2020-01-01 ~ 2020-03-31</title>
      <link>https://techblog.szksh.cloud/job-2020-01-01-03-31/</link>
      <pubDate>Sun, 29 Nov 2020 10:50:11 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/job-2020-01-01-03-31/</guid>
      <description>2020-01-01 から 2020-03-31 にかけて仕事でやったことを書きます。 勿論全部は書けないのでいくつかピックアップして書きます。
 Monorepo  更新検知のシェルスクリプトを Go でリプレース  CI の修正をリリース前に本番と同じ条件下で検証出来る仕組みを構築した話   CircleCI のコードリストアの改善(コスト削減・高速化)  リポジトリが非常にでかいので全部 checkout, restore すると時間がかかる Job ごとに必要最小限のコードだけをリストアすることで高速化     サーバの OS upgrade Ansible  CI の更新検知で、 PR の label で対象を指定できるようにした(コードに変更がなくてもテストが実行できるようにした)  たまにテストしたいときはある それまではてきとうにコードを修正しないとテストが実行されなかったが、 PR の label で対象の playbook を指定できるようにした   key=value 形式を YAML に変換  https://www.ansible.com/blog/ansible-best-practices-essentials  Use Native YAML Syntax       .circleci/config.yml のリファクタリング  job を parameterize して共通化したり parameterize された command を使って共通化したり コード量の大幅な削減   Terraform  CircleCI の環境変数を設定することで、 master での CI を一時的に禁止できるようにした  State を弄ってたりするときに予期せぬ apply が実行されないようにするため   master branch の CI が終わるまで wait  master の CI が走っている間に PR の CI でまだ apply されていないリソースが差分として出るのを防ぐ   shfmt, shellcheck の導入  CI/CD でシェルスクリプトを書いているので、それらを lint   State Locking の導入 Terraform Cloud の検証  結果、見送り すでに CI/CD pipeline を構築している自分たちにとっては、わざわざ移行するメリットが薄いと判断     MongoDB upgrade Jenkins Alternative の検証  RunDeck Argo Workflows 結局、ローカルで検証した程度    </description>
    </item>
    
    <item>
      <title>仕事でやったこと 2019-10-01 ~ 2019-12-31</title>
      <link>https://techblog.szksh.cloud/job-2019-10-01-12-31/</link>
      <pubDate>Sun, 29 Nov 2020 10:38:57 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/job-2019-10-01-12-31/</guid>
      <description>2019-10-01 から 2019-12-31 にかけて仕事でやったことを書きます。 勿論全部は書けないのでいくつかピックアップして書きます。
 Terraform  terraform fmt の導入 Terraform の upgrade v0.11 =&amp;gt; v0.12 State の分割 3 =&amp;gt; 40 弱(正確な数は忘れた) Conftest による lint: Remote Backend のパスを間違えるとまずいので test を導入 新しいサービスを追加するときのための generator (シェルスクリプト)を開発 CODEOWNERS の設定 突撃隣の Terraform リリースブランチをやめて GitHub Flow に移行 古いリビジョンで apply の実行の禁止(CI がこけるようにした)   Ansible  CI の高速化 Jenkins job を CircleCI の scheduled job にリプレース(脱 Jenkins) ローカルでの開発環境の改善  コンテナを使い回せるようにする   goss に置き換えて高速化   CI の改善  高速化(無駄な処理の削減)    </description>
    </item>
    
    <item>
      <title>Splitting .circleci/config.yml</title>
      <link>https://techblog.szksh.cloud/splitting-circleci-config/</link>
      <pubDate>Sat, 07 Nov 2020 14:43:10 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/splitting-circleci-config/</guid>
      <description>In this post I introduce how to split a huge .circleci/config.yml.
CircleCI doesn&amp;rsquo;t support to split .circleci/config.yml, so we manage all workflows and jobs configuration into one file .circleci/config.yml. If the repository is Monorepo, the more the number of services increases, the more the size of .circleci/config.yml becomes large and it&amp;rsquo;s hard to maintain .circleci/config.yml. By splitting .circleci/config.yml per service, it makes easy to maintain .circleci/config.yml and we can configure split file&amp;rsquo;s CODEOWNERS.</description>
    </item>
    
    <item>
      <title>github-ci-monitor: CI のステータスを DataDog で監視</title>
      <link>https://techblog.szksh.cloud/github-ci-monitor/</link>
      <pubDate>Sun, 01 Nov 2020 17:51:44 +0900</pubDate>
      
      <guid>https://techblog.szksh.cloud/github-ci-monitor/</guid>
      <description>自作の OSS github-ci-monitor の紹介です。
GitHub リポジトリの CI のステータスを定期的に取得し、 DataDog に送ることで、 CI のステータスを監視するツールです。 現状は AWS Lambda で動かすことを想定していますが、他の方法でも動かせるようにするつもりです。
Motivation モチベーションは、 PR をマージしたあとに CI がこけた場合に通知が欲しいというものです。 マージしたあとに CI が一瞬で終わるなら無事終わるのを見届けてもいいんですが、 数分かかると待ってるのも時間がもったいないです。 しばらくしたあとに結果を確認すればいいんですが、それも面倒くさいですし、普通に忘れます。 そうするとデプロイしたつもりが実は CI がこけてたなんてことが普通にあります。
そういうことにすぐ気づけるよう、 Slack に通知がほしいと思っていました。
仕組み 仕組みは単純です。
GitHub API で各リポジトリのステータスを取得し、 DataDog API でステータスを送信しています。 DataDog API は Service Check API を使っています。 status は以下のようになります。
 0: 正常 1: 異常 3: ステータスの取得に失敗  また以下の tag が付きます。
 owner: リポジトリのオーナー repo: リポジトリ名 ref: ブランチ名  各リポジトリのステータスは現状 3 つをサポートしています。</description>
    </item>
    
  </channel>
</rss>
